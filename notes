Home				CANT JOIN DOMAIN or USE GPE
Pro/Enterprise/Education	CAN JOIN DOMAIN or USE GPE

gpedit.msc	(Local) Group Policy Editor		Global
secpol.msc	Local Security Policy (Editor)		Local - brother of GPE

---------------------------------

## Enable file and printer sharing
Control Panel\Network and Internet\Network and Sharing Center\Advanced sharing settings
Network discovery:              disable->enable (enables port discovery)
File and printer sharing:       disable->enable (enables pinging)

		## Enable SMB
		Create file and share it

		--Windows 8.1, Windows Server 2012, Windows Server 2012 R2, Windows 10, and Windows Server 2019
		Get-SmbServerConfiguration | Select EnableSMB1Protocol
		Set-SmbServerConfiguration -EnableSMB1Protocol $false
		Set-SmbServerConfiguration -EnableSMB1Protocol $true

		Get-SmbServerConfiguration | Select EnableSMB2Protocol
		Set-SmbServerConfiguration -EnableSMB2Protocol $false
		Set-SmbServerConfiguration -EnableSMB2Protocol $true

		--Windows 7, Windows Server 2008 R2, Windows Vista, and Windows Server 2008
		Get-Item HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters | ForEach-Object {Get-ItemProperty $_.pspath}
		Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" SMB1 -Type DWORD -Value 0 -Force
		Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" SMB1 -Type DWORD -Value 1 -Force

		Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters | ForEach-Object {Get-ItemProperty $_.pspath}
		Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" SMB2 -Type DWORD -Value 0 -Force
		Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" SMB2 -Type DWORD -Value 1 -Force

		--Registry Editor
		HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters

		Registry entry: SMB1
		REG_DWORD: 0 = Disabled
		REG_DWORD: 1 = Enabled
		Default: 1 = Enabled (No registry key is created)

		Registry entry: SMB2
		REG_DWORD: 0 = Disabled
		REG_DWORD: 1 = Enabled
		Default: 1 = Enabled (No registry key is created)

## Enable Guest account
LSP -> Security Settings -> Local Policy -> Security Options -> Accounts: Guest account status | Disabled -> Enabled

## Remove Guest from 'deny access from - policy'
LSP -> Security Settings -> Local Policy -> User Right Assignment -> Deny access to this computer from the network | Remove Guest

## SAMR ENUMERATION
LSP -> Security Settings -> Local Policy -> Security Options -> Network access: Do not allow anonymous enumeration of SAM accounts | Enabled -> Disabled


-----------------------------

# shares
tree_id = conn.connectTree("IPC$")
conn.openFile(tree_id, "srvsvc")
shares = conn.listShares()
def list_shares(shares):
        for share in range(len(shares)):
                print(" --",shares[share]['shi1_netname'][:-1])

# read C$
conn.listPath("C$", "\*")

# transport.SMBTransport -> SMBConnection.connection
conn = SMBTransport(TARGET, filename="lsarpc", username=username, password=password)
dce = conn.get_dce_rpc()
dce.connect()
conn = conn.get_smb_connection()

# SMBConnection.connection -> transport.SMBTransport
conn = SMBConnection(TARGET, TARGET)
conn.login(username, password)
conn = SMBTransport(TARGET, filename="samr", smb_connection=conn)
dce = conn.get_dce_rpc()

# is the same
conn = SMBTransport(TARGET, filename="samr", username=username, password=password)
dce = conn.get_dce_rpc()
dce.connect()

conn = SMBConnection(TARGET, TARGET)
conn.login(username, password)
tree_id = conn.connectTree("IPC$")
file_id = conn.openFile(tree_id, "samr")

# guest
resp = hLsarOpenPolicy2(dce, POLICY_LOOKUP_NAMES)
policyHandle = resp['PolicyHandle']
hLsarLookupNames2(dce, policyHandle, (username,))
